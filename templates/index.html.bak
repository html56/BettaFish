<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®èˆ† - AIèˆ†æƒ…åˆ†æå¹³å°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/modern_style_new.css?v=3.2">
    <style>
        /* è‡ªå®šä¹‰æ ·å¼è¦†ç›– */
        .system-main-content {
            height: calc(100vh - 180px - 40px) !important;
        }

        /* æœç´¢åŒºåŸŸæè‡´ç¾åŒ– - Apple é£æ ¼æç®€è®¾è®¡ */
        .system-search-section {
            padding: 3.5rem 1.5rem !important;
            background: #ffffff !important;
            position: relative;
        }

        .search-card {
            max-width: 800px !important;
            padding: 6px !important;
            /* use solid white by default (remove the pale gray fill) */
            background: #ffffff !important;
            border-radius: 20px !important;
            /* deepen the border color for better contrast */
            border: 1px solid #c2c2c6 !important;
            /* only animate border-color and shadow so background stays stable */
            transition: box-shadow 0.25s ease, border-color 0.25s ease !important;
            margin: 0 auto !important;
            display: flex !important;
            align-items: center !important;
            box-shadow: none !important;
        }

        .search-card:focus-within {
            /* keep the card white on focus, but add a subtle blue glow */
            background: #ffffff !important;
            border-color: #0071e3 !important;
            box-shadow: 0 10px 30px rgba(0, 113, 227, 0.12) !important;
            outline: none !important;
        }

        .search-card-inner {
            display: flex !important;
            align-items: center !important;
            width: 100% !important;
            gap: 8px !important;
        }

        .search-left {
            flex: 1 !important;
            padding-left: 16px !important;
        }

        .system-search-input {
            width: 100% !important;
            height: 48px !important;
            font-size: 1.05rem !important;
            font-weight: 400 !important;
            color: #1d1d1f !important;
            background: transparent !important;
            border: none !important;
            outline: none !important;
        }

        .system-search-input::placeholder {
            color: #86868b !important;
        }

        .search-actions {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            padding-right: 6px !important;
        }

        .system-btn.primary#searchButton {
            height: 40px !important;
            padding: 0 20px !important;
            border-radius: 12px !important;
            font-size: 0.95rem !important;
            font-weight: 500 !important;
            background: #0071e3 !important;
            color: #ffffff !important;
            border: none !important;
            transition: all 0.2s ease !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            white-space: nowrap !important;
        }

        .system-btn.primary#searchButton:hover {
            background: #0077ed !important;
            transform: scale(1.02) !important;
        }

        .upload-button {
            height: 40px !important;
            padding: 0 16px !important;
            background: #ffffff !important;
            border: 1px solid #d2d2d7 !important;
            border-radius: 12px !important;
            font-weight: 500 !important;
            color: #1d1d1f !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            white-space: nowrap !important;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;
        }

        .upload-button:hover {
            background: #f5f5f7 !important;
            border-color: #86868b !important;
            color: #0071e3 !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
        }

        .upload-label {
            font-size: 0.9rem !important;
            display: flex !important;
            align-items: center !important;
            gap: 4px !important;
        }

        .search-divider {
            display: none !important;
        }

        /* å¼ºåˆ¶è®¾ç½®å·¦å³é¢æ¿æ¯”ä¾‹ä¸º 6:4 */
        .system-left-panel {
            flex: 3 !important;
        }

        .system-right-panel {
            flex: 2 !important;
        }

        .system-panel-content {
            height: calc(100% - 70px) !important;
        }
        
        /* è®ºå›æ¶ˆæ¯æ ·å¼ */
        .forum-message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--primary-surface);
            border: 1px solid var(--primary-border);
            border-radius: 8px;
        }
        
        .forum-message-header {
            font-weight: 600;
            color: var(--brand-primary);
            margin-bottom: 0.5rem;
        }
        
        .forum-message-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        /* æŠ¥å‘Šå†…å®¹æ ·å¼ */
        .report-content {
            padding: 1rem;
        }
        
        .report-content iframe {
            width: 100%;
            height: 600px;
            border: 1px solid var(--primary-border);
            border-radius: 8px;
        }
        
        /* æ§åˆ¶å°è¾“å‡ºæ ·å¼ */
        .console-line {
            margin-bottom: 0.25rem;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: 0.8125rem;
            line-height: 1.4;
        }
        
        /* é…ç½®è¡¨å•æ ·å¼ */
        .config-form-group {
            margin-bottom: 1.5rem;
        }
        
        .config-form-group-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .config-form-group-subtitle {
            color: var(--text-tertiary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }
        
        .config-form-field {
            margin-bottom: 1rem;
        }
        
        .config-form-label {
            display: block;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .config-form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            background: var(--primary-surface);
            border: 1px solid var(--primary-border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: var(--transition-fast);
        }
        
        .config-form-input:focus {
            outline: none;
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
        }
        
        .config-form-select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            background: var(--primary-surface);
            border: 1px solid var(--primary-border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="system-container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="system-header">
            <div class="system-logo">
                <img src="/static/image/logo_compressed.png" alt="BettaFish Logo" onerror="this.style.display='none'">
                <h1>å¾®èˆ†</h1>
            </div>
            <nav class="system-nav">
                <button class="system-btn" id="openConfigButton">
                    <span>âš™ï¸</span> é…ç½®
                </button>

            </nav>
        </header>

        <!-- æœç´¢åŒºåŸŸ -->
        <section class="system-search-section">
            <div class="system-search-title">
                <h2>AIèˆ†æƒ…åˆ†æå¹³å°</h2>
                <p>24å°æ—¶å…¨è‡ªåŠ¨ä»å¤šä¸ªç¤¾åª’å¹³å°æ·±åº¦çˆ¬å–èˆ†æƒ…æ•°æ®ï¼Œæä¾›ä¸“ä¸šçš„æƒ…æ„Ÿåˆ†æå’Œæ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ</p>
            </div>

            <!-- å¤§èƒ†ç¾åŒ–çš„æœç´¢æ§ä»¶ -->
            <div class="search-card" role="search" aria-label="æœç´¢èˆ†æƒ…">
                <form class="system-search-form search-card-inner" onsubmit="return false;">
                    <div class="search-left">
                        <input type="text" class="system-search-input" id="searchInput" placeholder="æ¢ç´¢å…¨çƒèˆ†æƒ…ï¼Œè¾“å…¥å…³é”®è¯å¼€å¯ AI æ·±åº¦æ´å¯Ÿ..." aria-label="æœç´¢å…³é”®è¯" autocomplete="off">
                    </div>

                    <div class="search-actions">
                        <button type="button" class="system-btn primary" id="searchButton" aria-label="å¼€å§‹åˆ†æ">
                            <span>ğŸš€</span> å¼€å¯åˆ†æ
                        </button>
                        
                        <label class="upload-button">
                            <input type="file" id="templateFileInput" accept=".md,.txt" title="ä¸Šä¼ è‡ªå®šä¹‰æŠ¥å‘Šæ¨¡æ¿">
                            <span class="upload-label"><span>ğŸ“„</span> ä¸Šä¼ æ¨¡æ¿</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="upload-status" id="uploadStatus" aria-live="polite" style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text-tertiary);"></div>

            <div class="search-divider" aria-hidden="true"></div>
        </section>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="system-main-content">
            <!-- å·¦ä¾§é¢æ¿ - ä¸»è¦å†…å®¹ -->
            <div class="system-left-panel">
                <div class="system-panel-header">
                    <h3>ğŸ“Š åˆ†æç»“æœ</h3>
                </div>
                <!-- åµŒå…¥é¡µé¢å¤´éƒ¨ï¼ˆä¾›JSè¯»å–æ ‡é¢˜æ˜¾ç¤ºï¼‰ -->
                <div class="embedded-header" id="embeddedHeader">åµŒå…¥çš„é¡µé¢</div>
                <style>
                    .embedded-header {
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        padding: 10px 16px;
                        background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,250,0.9));
                        border-radius: 10px;
                        box-shadow: 0 6px 18px rgba(0,0,0,0.06);
                        margin-bottom: 12px;
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
                    }
                    .embedded-header .title-left {
                        display: flex;
                        flex-direction: column;
                        gap: 2px;
                    }
                    .embedded-header .main-title {
                        font-size: 17px;
                        font-weight: 700;
                        color: #0f172a;
                    }
                    .embedded-header .sub-title {
                        font-size: 13px;
                        color: #64748b;
                        font-weight: 400;
                        margin-left: 6px;
                        background: none;
                        padding: 0;
                        border-radius: 0;
                        display: inline-block;
                    }
                    .embedded-header .desc {
                        font-size: 13px;
                        color: #334155;
                        margin-top: 4px;
                    }
                    .embedded-header .meta {
                        font-size: 13px;
                        color: #64748b;
                        white-space: nowrap;
                        margin-left: 12px;
                    }
                    /* å·¦ä¾§å°logoé£æ ¼ï¼ˆä»¿macOSï¼‰ */
                    .embedded-header .logo {
                        width: 36px;
                        height: 36px;
                        border-radius: 8px;
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                        margin-right: 12px;
                        background: linear-gradient(135deg,#60a5fa,#7c3aed);
                        color: white;
                        font-weight: 700;
                        box-shadow: 0 4px 10px rgba(124,58,237,0.12);
                    }
                </style>
                <div class="system-panel-content" id="embeddedContent">
                    <!-- æ¬¢è¿é¡µé¢ -->
                    <div class="system-card" id="welcomeContainer">
                        <div class="system-welcome-content">
                            <div class="system-welcome-icon">ğŸš€</div>
                            <h3 class="system-welcome-title">æ¬¢è¿ä½¿ç”¨å¾®èˆ†å¹³å°</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 2rem;">ä¸“ä¸šçš„AIèˆ†æƒ…åˆ†æè§£å†³æ–¹æ¡ˆ</p>
                            <div class="welcome-steps-card" aria-label="ä½¿ç”¨æ­¥éª¤å¡ç‰‡">
                                <h4 class="welcome-steps-title">ä½¿ç”¨æ­¥éª¤</h4>
                                <ol class="welcome-steps-list" aria-hidden="false">
                                    <li>ç‚¹å‡»å³ä¸Šè§’é…ç½®æŒ‰é’®ï¼Œè®¾ç½® LLM å‚æ•°</li>
                                    <li>åœ¨æœç´¢æ¡†è¾“å…¥è¦åˆ†æçš„è¯é¢˜æˆ–å…³é”®è¯</li>
                                    <li>ç‚¹å‡»"åˆ†æ"æŒ‰é’®å¯åŠ¨åˆ†ææµç¨‹</li>
                                    <li>å®æ—¶æŸ¥çœ‹å³ä¾§æ§åˆ¶å°çš„åˆ†æè¿›åº¦å’Œç»“æœ</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- è®ºå›å®¹å™¨ -->
                    <div class="system-card" id="forumContainer" style="display: none;">
                        <h4 style="margin-bottom: 1rem; color: var(--brand-primary);">
                            <span id="forumHeaderTitle" style="font-weight:600;">ğŸ¤– å¤šæ™ºèƒ½ä½“å¯¹è¯ - æ´å¯Ÿ | åª’ä½“ | æƒ…æŠ¥ | ä¸»æŒäºº</span>
                            <span id="forumMeta" style="float:right;font-size:0.9em;color:#666;">--:--:--</span>
                        </h4>
                    <div class="forum-chat-area" id="forumChatArea" style="max-height:60vh; overflow-y:auto; padding:1rem;">
                            <!-- åŠ¨æ€æ·»åŠ çš„Engineå¯¹è¯æ¶ˆæ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>

                    <!-- æŠ¥å‘Šå®¹å™¨ -->
                    <div class="system-card" id="reportContainer" style="display: none;">
                        <h4 style="margin-bottom: 1rem; color: var(--brand-primary);">ğŸ“ˆ æŠ¥å‘Š Agent - æœ€ç»ˆæŠ¥å‘Šç”Ÿæˆ</h4>
                        <div class="report-content" id="reportContent">
                            <!-- æŠ¥å‘Šå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§é¢æ¿ - æ§åˆ¶å°å’Œå¼•æ“çŠ¶æ€ï¼ˆæ¢å¤å¸¦æ ‡é¢˜æ å’Œçª—å£æ§åˆ¶æ ·å¼ï¼‰ -->
            <div class="system-right-panel">
                <div class="system-console">
                    <div class="system-console-header">
                        <div class="system-console-title">ç³»ç»Ÿæ§åˆ¶å°</div>
                        <div class="system-console-controls">
                            <span class="window-control red"></span>
                            <span class="window-control yellow"></span>
                            <span class="window-control green"></span>
                        </div>
                    </div>

                    <div class="system-panel-content" style="padding: 1rem;">
                        <!-- å¼•æ“åˆ‡æ¢å™¨ -->
                        <div class="system-app-switcher">
                            <button class="system-app-tab app-button active" data-app="insight">
                                <div class="system-status-indicator" id="status-insight"></div>
                                <div style="display:flex;flex-direction:column;align-items:center;line-height:1;">
                                    <div style="font-weight:600;">æ´å¯Ÿåˆ†æå¸ˆ</div>
                                    <div style="font-size:0.85em;color:#666;margin-top:4px;">Insight Agent</div>
                                </div>
                            </button>
                            <button class="system-app-tab app-button" data-app="media">
                                <div class="system-status-indicator" id="status-media"></div>
                                <div style="display:flex;flex-direction:column;align-items:center;line-height:1;">
                                    <div style="font-weight:600;">åª’ä½“åˆ†æå¸ˆ</div>
                                    <div style="font-size:0.85em;color:#666;margin-top:4px;">Media Agent</div>
                                </div>
                            </button>
                            <button class="system-app-tab app-button" data-app="query">
                                <div class="system-status-indicator" id="status-query"></div>
                                <div style="display:flex;flex-direction:column;align-items:center;line-height:1;">
                                    <div style="font-weight:600;">æƒ…æŠ¥æœé›†å‘˜</div>
                                    <div style="font-size:0.85em;color:#666;margin-top:4px;">Query Agent</div>
                                </div>
                            </button>
                            <button class="system-app-tab app-button" data-app="forum">
                                <div class="system-status-indicator running" id="status-forum"></div>
                                <div style="display:flex;flex-direction:column;align-items:center;line-height:1;">
                                    <div style="font-weight:600;">è®ºå›ä¸»æŒäºº</div>
                                    <div style="font-size:0.85em;color:#666;margin-top:4px;">Forum Host</div>
                                </div>
                            </button>
                            <button class="system-app-tab app-button locked" data-app="report" title="éœ€ç­‰å¾…å…¶ä½™ä¸‰ä¸ªAgentå·¥ä½œå®Œæ¯•">
                                <div class="system-status-indicator" id="status-report"></div>
                                <div style="display:flex;flex-direction:column;align-items:center;line-height:1;">
                                    <div style="font-weight:600;">æŠ¥å‘Šæ’°å†™å‘˜</div>
                                    <div style="font-size:0.85em;color:#666;margin-top:4px;">Report Agent</div>
                                </div>
                            </button>
                        </div>

                        <!-- æ§åˆ¶å°è¾“å‡º -->
                        <div class="console-divider" aria-hidden="true"></div>
                        <div class="system-console-output" id="consoleOutput">
                            <div class="console-line" style="color: var(--brand-primary);">[ç³»ç»Ÿ] åˆå§‹åŒ–å®Œæˆï¼Œç­‰å¾…ç”¨æˆ·æ“ä½œ...</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- ç³»ç»ŸçŠ¶æ€æ  -->
        <footer class="system-status-bar">
            <div class="system-status-left">
                <span id="systemStatus">ç³»ç»Ÿå°±ç»ª</span>
                <span id="lastUpdateTime">--:--:--</span>
            </div>
            <div class="system-status-right">
                <span>å¾®èˆ† v1.1.2</span>
                <span id="connectionStatus">â— å·²è¿æ¥</span>
            </div>
        </footer>
    </div>

    <!-- é…ç½®æ¨¡æ€æ¡† -->
    <div class="config-modal-overlay" id="configModal">
        <div class="config-modal-inner">
            <div class="config-modal">
                <div class="config-modal-header">
                    <div class="config-modal-title">LLM é…ç½® - ä¸.envæ–‡ä»¶åŒå‘åŒæ­¥</div>
                    <div class="config-modal-actions">
                        <button class="config-secondary-button" id="refreshConfigButton">ğŸ”„ åˆ·æ–°</button>
                        <button class="config-close-button" id="closeConfigModal" aria-label="å…³é—­é…ç½®çª—å£">Ã—</button>
                    </div>
                </div>
                <div class="config-modal-body" id="configFormContainer">
                    <!-- é…ç½®è¡¨å•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="config-modal-footer">
                    <div class="config-status-message" id="configStatusMessage"></div>
                    <div class="config-modal-footer-actions">
                        <button class="config-save-button" id="saveConfigButton">ğŸ’¾ ä¿å­˜</button>
                        <button class="config-start-button" id="startSystemButton">ğŸš€ ä¿å­˜å¹¶å¯åŠ¨ç³»ç»Ÿ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¶ˆæ¯æç¤º -->
    <div id="message" class="message"></div>

    <script>
        // å…¨å±€å˜é‡
        let socket;
        let currentApp = 'insight';
        let appStatus = {
            insight: 'stopped',
            media: 'stopped',
            query: 'stopped',
            forum: 'stopped',  // å‰ç«¯å¯åŠ¨åå†æ ‡è®°ä¸º running
            report: 'stopped'  // Report Engine
        };
        let customTemplate = ''; // å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„è‡ªå®šä¹‰æ¨¡æ¿å†…å®¹
        let configValues = {};
        let configDirty = false;
        let configAutoRefreshTimer = null;
        let systemStarted = false;
        let systemStarting = false;
        let configModalLocked = false;

        const CONFIG_ENDPOINT = '/api/config';
        const SYSTEM_STATUS_ENDPOINT = '/api/system/status';
        const SYSTEM_START_ENDPOINT = '/api/system/start';
        const START_BUTTON_DEFAULT_TEXT = 'ä¿å­˜å¹¶å¯åŠ¨ç³»ç»Ÿ';

        const configFieldGroups = [
            {
                title: 'æ•°æ®åº“è¿æ¥',
                subtitle: 'ç”¨äºè¿æ¥ä¸šåŠ¡æ•°æ®åº“çš„åŸºæœ¬é…ç½®',
                fields: [
                    { key: 'DB_DIALECT', label: 'æ•°æ®åº“ç±»å‹', type: 'select', options: ['mysql', 'postgresql'] },
                    { key: 'DB_HOST', label: 'ä¸»æœºåœ°å€' },
                    { key: 'DB_PORT', label: 'ç«¯å£' },
                    { key: 'DB_USER', label: 'ç”¨æˆ·å' },
                    { key: 'DB_PASSWORD', label: 'å¯†ç ', type: 'password' },
                    { key: 'DB_NAME', label: 'æ•°æ®åº“åç§°' },
                    { key: 'DB_CHARSET', label: 'å­—ç¬¦é›†' }
                ]
            },
            {
                title: 'æ´å¯Ÿåˆ†æå¸ˆ (Insight Agent)',
                subtitle: 'è´Ÿè´£æ´å¯Ÿåˆ†æçš„æ¨¡å‹é…ç½®',
                fields: [
                    { key: 'INSIGHT_ENGINE_API_KEY', label: 'API Key' },
                    { key: 'INSIGHT_ENGINE_BASE_URL', label: 'Base URL' },
                    { key: 'INSIGHT_ENGINE_MODEL_NAME', label: 'æ¨¡å‹åç§°' }
                ]
            },
            {
                title: 'åª’ä½“åˆ†æå¸ˆ (Media Agent)',
                subtitle: 'åª’ä½“å†…å®¹ç†è§£ä¸ç”Ÿæˆæ¨¡å‹',
                fields: [
                    { key: 'MEDIA_ENGINE_API_KEY', label: 'API Key' },
                    { key: 'MEDIA_ENGINE_BASE_URL', label: 'Base URL' },
                    { key: 'MEDIA_ENGINE_MODEL_NAME', label: 'æ¨¡å‹åç§°' }
                ]
            },
            {
                title: 'æƒ…æŠ¥æœé›†å‘˜ (Query Agent)',
                subtitle: 'è´Ÿè´£æœç´¢ä¸ä¿¡æ¯æ±‡æ€»çš„æ¨¡å‹é…ç½®',
                fields: [
                    { key: 'QUERY_ENGINE_API_KEY', label: 'API Key' },
                    { key: 'QUERY_ENGINE_BASE_URL', label: 'Base URL' },
                    { key: 'QUERY_ENGINE_MODEL_NAME', label: 'æ¨¡å‹åç§°' }
                ]
            },
            {
                title: 'æŠ¥å‘Šæ’°å†™å‘˜ (Report Agent)',
                subtitle: 'æŠ¥å‘Šç”Ÿæˆä½¿ç”¨çš„æ¨¡å‹é…ç½®',
                fields: [
                    { key: 'REPORT_ENGINE_API_KEY', label: 'API Key' },
                    { key: 'REPORT_ENGINE_BASE_URL', label: 'Base URL' },
                    { key: 'REPORT_ENGINE_MODEL_NAME', label: 'æ¨¡å‹åç§°' }
                ]
            },
            {
                title: 'è®ºå›ä¸»æŒäºº (Forum Host)',
                subtitle: 'å¤šæ™ºèƒ½ä½“ååŒä½¿ç”¨çš„æ¨¡å‹é…ç½®',
                fields: [
                    { key: 'FORUM_HOST_API_KEY', label: 'API Key' },
                    { key: 'FORUM_HOST_BASE_URL', label: 'Base URL' },
                    { key: 'FORUM_HOST_MODEL_NAME', label: 'æ¨¡å‹åç§°' }
                ]
            },
            {
                title: 'Keyword Optimizer',
                subtitle: 'SQL / å…³é”®è¯ä¼˜åŒ–æ¨¡å‹é…ç½®',
                fields: [
                    { key: 'KEYWORD_OPTIMIZER_API_KEY', label: 'API Key' },
                    { key: 'KEYWORD_OPTIMIZER_BASE_URL', label: 'Base URL' },
                    { key: 'KEYWORD_OPTIMIZER_MODEL_NAME', label: 'æ¨¡å‹åç§°' }
                ]
            },
            {
                title: 'å¤–éƒ¨æ£€ç´¢å·¥å…·',
                subtitle: 'è”åŠ¨æœç´¢å¼•æ“ã€ç½‘ç«™æŠ“å–ç­‰åœ¨çº¿æœåŠ¡',
                fields: [
                    { key: 'TAVILY_API_KEY', label: 'Tavily API Key' },
                    { key: 'BOCHA_WEB_SEARCH_API_KEY', label: 'Bocha API Key' }
                ]
            }
        ];

        // åº”ç”¨åç§°æ˜ å°„
        const appNames = {
            insight: 'æ´å¯Ÿå¼•æ“ (Insight Engine)',
            media: 'åª’ä½“å¼•æ“ (Media Engine)', 
            query: 'æƒ…æŠ¥å¼•æ“ (Query Engine)',
            forum: 'è®ºå›å¼•æ“ (Forum Engine)',
            report: 'æŠ¥å‘Šå¼•æ“ (Report Engine)'
        };

        // é¡µé¢å¤´éƒ¨æ˜¾ç¤ºçš„å®Œæ•´Agentä»‹ç»
        const agentTitles = {
            insight: 'æ´å¯Ÿåˆ†æå¸ˆ (Insight Agent) - ç§æœ‰æ•°æ®åº“æŒ–æ˜',
            media: 'åª’ä½“åˆ†æå¸ˆ (Media Agent) - å¤šæ¨¡æ€å†…å®¹åˆ†æ',
            query: 'æƒ…æŠ¥æœé›†å‘˜ (Query Agent) - ç²¾å‡†ä¿¡æ¯æœç´¢',
            forum: 'è®ºå›ä¸»æŒäºº (Forum Host) - å¤šæ™ºèƒ½ä½“äº¤æµ',
            report: 'æŠ¥å‘Šæ’°å†™å‘˜ (Report Agent) - æœ€ç»ˆæŠ¥å‘Šç”Ÿæˆ'
        };

        // ç»Ÿä¸€æ¸²æŸ“åµŒå…¥é¡µé¢é¡¶éƒ¨æ ‡é¢˜çš„å‡½æ•°
        function renderEmbeddedHeader(app) {
            const headerEl = document.getElementById('embeddedHeader');
            if (!headerEl) return;
            // logo é¦–å­—æ¯æ˜ å°„
            const logoInitials = {
                insight: 'IA',
                media: 'MA',
                query: 'QA',
                forum: 'FH',
                report: 'RA'
            };
            if (app === 'forum') {
                const initials = logoInitials[app] || 'FH';
                headerEl.innerHTML = `
                    <div style="display:flex;align-items:center;">
                        <div class="logo">${initials}</div>
                        <div class="title-left">
                            <div style="display:flex;align-items:baseline;gap:6px;">
                                <div class="main-title">å¤šæ™ºèƒ½ä½“å¯¹è¯</div>
                                <div class="sub-title" style="font-size:13px;color:#64748b;">Forum Engine</div>
                            </div>
                            <div class="desc">æ´å¯Ÿ | åª’ä½“ | æƒ…æŠ¥ | ä¸»æŒäºº</div>
                        </div>
                    </div>
                `;
                if (typeof updateForumMeta === 'function') updateForumMeta();
                return;
            }

            const full = agentTitles[app] || appNames[app] || app;
            const chinese = full.split(' (')[0] || full;
            const englishMatch = full.match(/\(([^)]+)\)/);
            const english = englishMatch ? englishMatch[1] : '';
            const descMatch = full.match(/\)\s*-\s*(.*)$/);
            const desc = descMatch ? descMatch[1] : '';
            const initials = logoInitials[app] || 'BF';
...
